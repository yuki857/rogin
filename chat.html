<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チャット</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; margin-top: 20px; }
        #chatBox { width: 80%; height: 300px; border: 1px solid #ccc; overflow-y: auto; padding: 10px; margin: 0 auto; }
        input { width: 70%; padding: 10px; font-size: 16px; }
        button { padding: 10px 20px; font-size: 16px; margin-left: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1 id="chatTitle">チャット</h1>
    <div id="chatBox"></div>
    <input type="text" id="messageInput" placeholder="メッセージを入力">
    <button id="sendBtn">送信</button>
    <script>
        // URLから友達のコードを取得
        const urlParams = new URLSearchParams(window.location.search);
        const friendCode = urlParams.get("code");

        if (!friendCode) {
            alert("友達のコードが見つかりません！");
            window.location.href = "friends.html"; // 友達一覧に戻る
        }

        // 友達の名前を取得
        let friends = JSON.parse(localStorage.getItem("friends")) || [];
        let friend = friends.find(f => f.code === friendCode);

        if (!friend) {
            alert("この友達は存在しません！");
            window.location.href = "friends.html";
        }

        document.getElementById("chatTitle").textContent = `チャット - ${friend.name}`;

        // チャット履歴を取得
        let chatHistory = JSON.parse(localStorage.getItem(`chat_${friendCode}`)) || [];

        const chatBox = document.getElementById("chatBox");

        function displayMessages() {
            chatBox.innerHTML = "";
            chatHistory.forEach(msg => {
                let p = document.createElement("p");
                p.textContent = msg;
                chatBox.appendChild(p);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        displayMessages();

        // メッセージを送信
        document.getElementById("sendBtn").addEventListener("click", function() {
            const messageInput = document.getElementById("messageInput");
            const message = messageInput.value.trim();

            if (message) {
                chatHistory.push(message);
                localStorage.setItem(`chat_${friendCode}`, JSON.stringify(chatHistory));
                displayMessages();
                messageInput.value = "";
            }
        });
        <script>
    const urlParams = new URLSearchParams(window.location.search);
    const friendCode = urlParams.get("code");

    if (!friendCode) {
        alert("友達のコードが見つかりません！");
        window.location.href = "friends.html";
    }

    let friends = JSON.parse(localStorage.getItem("friends")) || [];
    let friend = friends.find(f => f.code === friendCode);

    if (!friend) {
        alert("この友達は存在しません！");
        window.location.href = "friends.html";
    }

    document.getElementById("chatTitle").textContent = `チャット - ${friend.name}`;

    let chatHistory = JSON.parse(localStorage.getItem(`chat_${friendCode}`)) || [];

    const chatBox = document.getElementById("chatBox");

    function displayMessages() {
        chatBox.innerHTML = "";
        chatHistory.forEach(msg => {
            let p = document.createElement("p");
            p.textContent = msg;
            chatBox.appendChild(p);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    displayMessages();

    document.getElementById("sendBtn").addEventListener("click", function() {
        const messageInput = document.getElementById("messageInput");
        const message = messageInput.value.trim();

        if (message) {
            chatHistory.push(message);
            localStorage.setItem(`chat_${friendCode}`, JSON.stringify(chatHistory));
            displayMessages();
            messageInput.value = "";
        }
    });
</script>
    </script>
</body>
</html>
